
<h3 class="sectionedit1" id="ilp32_on_centos">ILP32 on CentOS</h3>
<div class="level3">

<p>
1. Need install the package
vi /etc/yum.repos.d/CentOS-Base.repo
set gpgcheck=0; yum update; then set gpgcheck=1
</p>
<pre class="code">yum -y --nogpgcheck groupinstall &quot;Development Tools&quot;
yum -y --nogpgcheck install ncurses-devel perl-core
yum -y --nogpgcheck install hmaccalc zlib-devel binutils-devel elfutils-devel 
yum -y --nogpgcheck install newt-devel python-devel
yum -y --nogpgcheck install audit-libs-devel numactl-devel pciutils-devel
yum -y --nogpgcheck install bc bison perl-ExtUtils-Embed.noarch xmlto asciidoc
yum -y --nogpgcheck install lsof redhat-rpm-config rpm-build libxml2-python gcc
yum -y --nogpgcheck install net-tools wget
yum -y --nogpgcheck install openssl-devel
yum -y --nogpgcheck install install glib*</pre>

<p>
2. Download and install APM native toolchain to the board (for ILP32 only)
</p>
<pre class="code"> wget ftp://amccsw:special4u@ftp.amcc.com/outbound/storm/SPEC/apm-8.0.11-le-20161010-nativetools.tar.bz2
 wget ftp://amccsw:special4u@ftp.apm.com/apmsw/toolchains/apm-8.0.10-le-20150429-patches.tar.bz2 
 scp hule@10.38.12.20:/AMCC/hule/ILP32/package/4.5/\{*.xz,*.tgz,*.bz2,*.tar\} ./
 sudo mkdir -p /opt/apm/8.0.11-le/
 sudo tar --strip-components=1 -xf apm-8.0.11-le-20161010-nativetools.tar.bz2 -C /opt/apm/8.0.11-le
 tar xf apm-le-nativetools-patch.tar.bz2 -C /opt/apm/8.0.11-le/
 #wget ftp://amccsw:special4u@ftp.apm.com/apmsw/toolchains/apm-8.0.10-le-20150429-nativetools.tar.bz2
 #wget ftp://amccsw:special4u@ftp.apm.com/apmsw/toolchains/apm-8.0.10-le-20150429-patches.tar.bz2
 #mkdir -p /opt/apm/8.0.10-le
 #tar --strip-components=1 -xf apm-8.0.10-le-20150429-nativetools.tar.bz2 -C /opt/apm/8.0.10-le
 #tar -xf apm-8.0.10-le-20150429-patches.tar.bz2 -C /opt/apm/8.0.10-le
 scp hule@10.38.12.21:/hcm_software/ftproot/toolchain/apm-8.0.12/prebuilt/\{apm-8.0.12-le-20161128-nativetools.tar.bz2,apm-le-nativetools-patch.tar.bz2/} ./
 sudo mkdir -p /opt/apm/8.0.12-le/
 sudo tar --strip-components=1 -xf apm-8.0.12-le-20161128-nativetools.tar.bz2 -C /opt/apm/8.0.12-le
 tar xf apm-le-nativetools-patch.tar.bz2 -C /opt/apm/8.0.12-le/
 </pre>

<p>
3. Download CentOS kernel source
</p>
<pre class="code"># git clone git://git.centos.org/centos-git-common.git
# git clone git://vdcsw001/git/centos/sig-altarch-kernel.git 
# cd sig-altarch-kernel/
# git branch -a
*master
remotes/origin/3.19-apm
remotes/origin/HEAD -&gt; origin/master
remotes/origin/cavium
remotes/origin/master
remotes/origin/sig-altarch7-aarch64
remotes/origin/vdcsw-centos-7.2
remotes/origin/vdcsw-centos-7.3
#git checkout vdcsw-centos-7.3</pre>

<p>
4. Run SpecInit
- Refer in the attachment file: Executing-SPECCPU-On-Linux-XGene_v1.10.pdf
</p>
<pre class="code">export PATH=/opt/apm/8.0.11-le/usr/bin:$PATH
tar xf linux-apm-arm64-118.tar -C ~/specint12
tar xf spec_apm_ilp32_config_toolchain_8.0.11.tgz -C ~/specint12
cd specint12
./install.sh -u linux-apm-arm64 -d ./
source ./shrc
rm -fr benchspec/CPU2006/*/build/*
rm -fr benchspec/CPU2006/*/exe/*
rm -fr benchspec/CPU2006/*/run/*
runspec --config=linux_arm64_le_peak.cfg --size=ref --rate=8 --noreportable int

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^^^^</pre>

<p>
^                                             ^ Compilation  ^ Run      ^ Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
</p>
<div class="table sectionedit2"><table class="inline">
	<tr class="row0">
		<td class="col0 leftalign"> Defconfig (64K + el0 + ilp32 disable)       </td><td class="col1 leftalign"> Compilation  </td><td class="col2 leftalign"> Run      </td><td class="col3 leftalign"> Note                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 64-bit mode                                 </td><td class="col1 leftalign"> Pass         </td><td class="col2 leftalign"> Fail     </td><td class="col3 leftalign"> -bash: ./signal: cannot execute binary file: Exec format error<br/>
[root@(none) ~]# ./msgrcv <br/>
-bash: ./msgrcv: cannot execute binary file: Exec format error<br/>
[root@(none) ~]# ./msgsnd <br/>
-bash: ./msgsnd: cannot execute binary file: Exec format error<br/>
[root@(none) ~]#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 32-bit mode                                 </td><td class="col1 leftalign">              </td><td class="col2 leftalign">          </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> ILP32-bit mode                              </td><td class="col1 leftalign"> Blocked      </td><td class="col2 leftalign"> Blocked  </td><td class="col3 leftalign"> Boot up failed:<br/>
…<br/>
[    2.028765] devtmpfs: mounted<br/>
[    2.031879] Freeing unused kernel memory: 736K (ffffffc000a4a000 - ffffffc000b02000)<br/>
[    2.259756] request_module: runaway loop modprobe binfmt-464c<br/>
[    2.266490] Starting init: /sbin/init exists but couldn&#039;t execute it (error -8)<br/>
[    2.342443] request_module: runaway loop modprobe binfmt-464c<br/>
[    2.349127] Starting init: /bin/sh exists but couldn&#039;t execute it (error -8)<br/>
[    2.356186] Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/init.txt for guidance.<br/>
[    2.369247] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.5.0+ #5<br/>
[    2.375135] Hardware name: AppliedMicro X-Gene Mustang Board/X-Gene Mustang Board, BIOS 3.06.25 Oct 17 2016<br/>
[    2.384823] Call trace:<br/>
[    2.387259] [&lt;ffffffc0000885f0&gt;] dump_backtrace+0x0/0x1b0<br/>
[    2.392630] [&lt;ffffffc0000887b4&gt;] show_stack+0x14/0x20<br/>
[    2.397655] [&lt;ffffffc000342394&gt;] dump_stack+0x94/0xc0<br/>
[    2.402681] [&lt;ffffffc000154c8c&gt;] panic+0x10c/0x278<br/>
[    2.407447] [&lt;ffffffc00073fe04&gt;] kernel_init+0xe4/0xf0<br/>
[    2.412557] [&lt;ffffffc000083a00&gt;] ret_from_fork+0x10/0x50<br/>
[    2.417844] —[ end Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/init.txt for guidance.<br/>
[   17.223995] random: nonblocking pool is initialized                                                                             </td>
	</tr>
	<tr class="row4">
		<th class="col0 leftalign" colspan="4"> 64K Page Size Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </th>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 64-bit mode                                 </td><td class="col1 leftalign"> Pass         </td><td class="col2 leftalign"> Fail     </td><td class="col3 leftalign"> [root@(none) ~]# ./signal <br/>
-bash: ./signal: cannot execute binary file: Exec format error<br/>
[root@(none) ~]# ./msgrcv <br/>
-bash: ./msgrcv: cannot execute binary file: Exec format error<br/>
[root@(none) ~]# ./msgrcv <br/>
-bash: ./msgrcv: cannot execute binary file: Exec format error<br/>
[root@(none) ~]#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 32-bit mode                                 </td><td class="col1 leftalign">              </td><td class="col2 leftalign">          </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> ILP32-bit mode                              </td><td class="col1 leftalign"> Blocked      </td><td class="col2 leftalign"> Blocked  </td><td class="col3 leftalign"> Boot up kernel crash<br/>
….<br/>
[    2.056350] VFS: Mounted root (ext4 filesystem) on device 8:16.<br/>
[    2.087518] devtmpfs: mounted<br/>
[    2.090562] Freeing unused kernel memory: 832K (fffffe0000a60000 - fffffe0000b30000)<br/>
[    2.315367] request_module: runaway loop modprobe binfmt-464c<br/>
[    2.321994] Starting init: /sbin/init exists but couldn&#039;t execute it (error -8)<br/>
[    2.394499] request_module: runaway loop modprobe binfmt-464c<br/>
[    2.401086] Starting init: /bin/sh exists but couldn&#039;t execute it (error -8)<br/>
[    2.408143] Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/init.txt for guidance.<br/>
[    2.421204] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.5.0+ #3<br/>
[    2.427093] Hardware name: AppliedMicro X-Gene Mustang Board/X-Gene Mustang Board, BIOS 3.06.25 Oct 17 2016<br/>
[    2.436782] Call trace:<br/>
[    2.439218] [&lt;fffffe00000885f0&gt;] dump_backtrace+0x0/0x1b0<br/>
[    2.444589] [&lt;fffffe00000887b4&gt;] show_stack+0x14/0x20<br/>
[    2.449614] [&lt;fffffe0000341514&gt;] dump_stack+0x94/0xc0<br/>
[    2.454638] [&lt;fffffe000015441c&gt;] panic+0x10c/0x278<br/>
[    2.459404] [&lt;fffffe000073f394&gt;] kernel_init+0xe4/0xf0<br/>
[    2.464513] [&lt;fffffe0000083a00&gt;] ret_from_fork+0x10/0x50<br/>
[    2.469799] —[ end Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/init.txt for guidance.<br/>
[   12.046804] random: nonblocking pool is initialized  </td>
	</tr>
	<tr class="row8">
		<th class="col0 leftalign" colspan="4"> 64K + ILP32 Enable; EL0 Disable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </th>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> 64-bit mode                                 </td><td class="col1 leftalign"> Pass         </td><td class="col2 leftalign"> Pass     </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> 32-bit mode                                 </td><td class="col1 leftalign">              </td><td class="col2 leftalign">          </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> ILP32-bit mode                              </td><td class="col1 leftalign"> Pass         </td><td class="col2 leftalign"> Pass     </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row12">
		<th class="col0 leftalign" colspan="4"> ILP32 + EL0 Enable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </th>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> Rootfs armv8-64bit                          </td><td class="col1 leftalign"> Pass         </td><td class="col2 leftalign"> Pass     </td><td class="col3 leftalign"> [root@(none) ~]# file hello_32 msgrcv_32 msgsnd_32 signal_32<br/>
hello_32:  ELF 32-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
msgrcv_32: ELF 32-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
msgsnd_32: ELF 32-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
signal_32: ELF 32-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
[root@(none) ~]# file hello_64 msgrcv_64 msgsnd_64 signal_64<br/>
hello_64:  ELF 64-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
msgrcv_64: ELF 64-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
msgsnd_64: ELF 64-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
signal_64: ELF 64-bit LSB executable, version 1 (SYSV), statically linked, for GNU/Linux 3.7.0, not stripped<br/>
[root@(none) ~]#                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> Rootfs-armv7-32bit                          </td><td class="col1 leftalign">              </td><td class="col2 leftalign">          </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign"> Rootfs-ILP32-64bit                          </td><td class="col1 leftalign"> Pass         </td><td class="col2 leftalign"> Pass     </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row16">
		<th class="col0 leftalign">                                             </th><th class="col1 leftalign">              </th><th class="col2 leftalign">          </th><th class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </th>
	</tr>
	<tr class="row17">
		<th class="col0 leftalign"> Notes:                                      </th><td class="col1 leftalign">              </td><td class="col2 leftalign">          </td><td class="col3 leftalign">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row18">
		<th class="col0 leftalign" colspan="4"> gcc -mabi=ilp32 msgrcv.c -o msgrcv -static                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </th>
	</tr>
	<tr class="row19">
		<th class="col0 leftalign" colspan="4"> ./msgrcv                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </th>
	</tr>
	<tr class="row20">
		<th class="col0 leftalign" colspan="4">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </th>
	</tr>
</table></div>
<!-- EDIT2 TABLE [6121-38460] -->
</div>
